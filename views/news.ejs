<%- include('partials/header') %>
<link rel="stylesheet" href="/css/styleNewsFeed.css">

<div class="container" style="max-width: 1200px; padding: 40px 20px;">
    
    <div style="text-align: center; margin-bottom: 50px;" data-animate="fade-down">
        <h1 style="font-size: 3rem; font-weight: 900; margin-bottom: 10px;">üì∞ B·∫£n Tin HTTD</h1>
        <p style="color: #666; max-width: 600px; margin: 0 auto;">
            C·∫≠p nh·∫≠t nh·ªØng th√¥ng tin n√≥ng h·ªïi, s·ª± ki·ªán v√† b√≠ k√≠p h·ªçc t·∫≠p m·ªõi nh·∫•t.
        </p>
        
        <% if(user && user.isPro) { %>
            <div style="margin-top: 30px;">
                <a href="/news/post" class="btn btn-primary">
                    <i class="fas fa-pen-nib"></i> Vi·∫øt b√†i m·ªõi
                </a>
            </div>
        <% } %>
    </div>

    <div class="news-grid">
        <% if(newsList && newsList.length > 0) { %>
            <% newsList.forEach((news, idx) => { %>
                <article class="news-card" data-animate="fade-up" style="animation-delay: <%= idx * 0.1 %>s">
                    
                    <div class="news-thumb-wrapper">
                        <img src="<%= news.image || 'https://media.istockphoto.com/id/1197831888/vector/male-hand-holding-megaphone-with-breaking-news-speech-bubble-loudspeaker-banner-for-business.jpg?s=612x612&w=0&k=20&c=4CvdND_C8H3AxDMlEAZ8j9oagSvlmMcNHlrVoqoc9KQ=' %>" 
                             class="news-thumb" 
                             alt="Thumbnail">
                        <span class="news-cat-badge"><%= news.category || 'Tin t·ª©c' %></span>
                    </div>

                    <div class="news-content">
                        <div class="news-date">
                            <i class="far fa-clock"></i> 
                            <%= new Date(news.createdAt).toLocaleDateString('vi-VN') %>
                        </div>
                        
                        <a href="/news/<%= news._id %>" style="text-decoration: none;">
                            <h2 class="news-title"><%= news.title %></h2>
                        </a>

                        <p class="news-excerpt">
                            <%= news.content.replace(/[#*`]/g, '').substring(0, 150) %>...
                        </p>

                        <div class="news-footer">
                            <div class="author-info">
                                <img src="<%= news.author && news.author.avatar ? news.author.avatar : 'https://cdn-icons-png.flaticon.com/512/847/847969.png' %>" class="author-avatar">
                                <span><%= news.author ? news.author.username : 'Admin' %></span>
                            </div>
                            <a href="/news/<%= news._id %>" class="read-more-link">ƒê·ªçc ti·∫øp &rarr;</a>
                        </div>
                    </div>

                </article>
            <% }) %>
        <% } else { %>
            <div style="grid-column: 1/-1; text-align: center; padding: 50px; color: #999;">
                <i class="far fa-newspaper" style="font-size: 4rem; margin-bottom: 20px;"></i>
                <h3>Ch∆∞a c√≥ tin t·ª©c n√†o.</h3>
                <p>H√£y tr·ªü th√†nh ng∆∞·ªùi ƒë·∫ßu ti√™n vi·∫øt b√†i!</p>
            </div>
        <% } %>
    </div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        
        // Ki·ªÉm tra xem GSAP c√≥ ho·∫°t ƒë·ªông kh√¥ng
        if (typeof gsap !== 'undefined') {
            
            // 1. Header & N√∫t "Vi·∫øt b√†i m·ªõi"
            const header = document.querySelector('[data-animate="fade-down"]');
            if(header) {
                gsap.fromTo(header, 
                    { y: -30, opacity: 0 }, 
                    { y: 0, opacity: 1, duration: 0.8, ease: 'power2.out', clearProps: 'all' }
                );
            }

            // 2. Danh s√°ch tin t·ª©c (News Cards)
            const cards = document.querySelectorAll('.news-card');
            if(cards.length > 0) {
                gsap.fromTo(cards, 
                    { y: 50, opacity: 0 }, 
                    { 
                        y: 0, 
                        opacity: 1, 
                        duration: 0.6, 
                        stagger: 0.1, // Hi·ªáu ·ª©ng xu·∫•t hi·ªán l·∫ßn l∆∞·ª£t
                        ease: 'power2.out', 
                        clearProps: 'all' // Quan tr·ªçng: X√≥a style inline sau khi xong ƒë·ªÉ hover ho·∫°t ƒë·ªông t·ªët
                    }
                );
            }

        } else {
            // FALLBACK: N·∫øu GSAP l·ªói, √©p hi·ªÉn th·ªã t·∫•t c·∫£ ngay l·∫≠p t·ª©c
            console.warn("GSAP not detected. Forcing visibility.");
            document.querySelectorAll('[data-animate], .news-card').forEach(el => {
                el.style.opacity = '1';
                el.style.transform = 'none';
                el.style.visibility = 'visible';
            });
        }
    });
</script>

<%- include('partials/footer') %>