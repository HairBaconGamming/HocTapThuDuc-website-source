<%- include('partials/header') %>
<link rel="stylesheet" href="/css/styleProImages.css">

<div class="container">
    <div class="gallery-header">
        <h1>Kho ·∫¢nh PRO üì∏</h1>
        <p>L∆∞u gi·ªØ nh·ªØng kho·∫£nh kh·∫Øc h·ªçc t·∫≠p (ho·∫∑c meme) c·ªßa b·∫°n!</p>
    </div>

    <form action="/api/pro-images/upload" method="POST" enctype="multipart/form-data" id="uploadForm">
        <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
            <div class="upload-icon">‚òÅÔ∏è</div>
            <h3>B·∫•m ƒë·ªÉ ch·ªçn ·∫£nh ho·∫∑c k√©o th·∫£ v√†o ƒë√¢y</h3>
            <p style="color: #999;">H·ªó tr·ª£ JPG, PNG, GIF (T·ªëi ƒëa 5MB)</p>
            <input type="file" name="image" id="fileInput" style="display: none;" onchange="document.getElementById('uploadForm').submit()">
        </div>
    </form>

    <div class="gallery-grid" id="galleryGrid">
        <div style="text-align: center; width: 100%; grid-column: 1/-1; padding: 20px;">
            <i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i th∆∞ vi·ªán...
        </div>
    </div>
</div>

<script>
    // Script load ·∫£nh ƒë∆°n gi·∫£n
    document.addEventListener('DOMContentLoaded', async () => {
        const grid = document.getElementById('galleryGrid');
        try {
            const res = await fetch('/api/pro-images/list');
            const images = await res.json();
            
            if(images.length === 0) {
                grid.innerHTML = '<p style="text-align:center; width:100%;">Ch∆∞a c√≥ ·∫£nh n√†o. Upload ngay ƒëi!</p>';
                return;
            }

            let html = '';
            images.forEach(img => {
                html += `
                    <div class="img-card">
                        <img src="${img.url}" class="img-thumb" loading="lazy">
                        <div class="img-actions">
                            <span style="font-size:0.8rem; color:#888;">${new Date(img.uploadDate).toLocaleDateString('vi-VN')}</span>
                            <div style="display:flex; gap:10px;">
                                <button class="btn-icon btn-copy" onclick="copyUrl('${img.url}')" title="Copy Link"><i class="fas fa-link"></i></button>
                                <button class="btn-icon btn-delete" onclick="deleteImg('${img._id}')" title="X√≥a"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    </div>
                `;
            });
            grid.innerHTML = html;
        } catch (e) {
            grid.innerHTML = '<p style="color:red; text-align:center;">L·ªói t·∫£i ·∫£nh.</p>';
        }
    });

    function copyUrl(url) {
        navigator.clipboard.writeText(url);
        alert('ƒê√£ copy link ·∫£nh!');
    }

    async function deleteImg(id) {
        if(!confirm('X√≥a ·∫£nh n√†y nha?')) return;
        await fetch(`/api/pro-images/${id}`, { method: 'DELETE' });
        window.location.reload();
    }
</script>

<%- include('partials/footer') %>