<%- include('partials/header') %>
<link rel="stylesheet" href="/css/myTree.css">

<div class="container tree-section">
    <div class="tree-card">
        <div class="tree-bg"></div> <div class="tree-content">
            <span class="level-badge">Level <%= treeData.treeLevel %></span>
            
            <div class="tree-visual">
                <% 
                    // B·ªô s∆∞u t·∫≠p ·∫£nh c√¢y theo t·ª´ng c·∫•p ƒë·ªô (C≈©)
                    const treeImages = [
                        "https://cdn.glitch.global/71030012-56ea-4d26-a426-e0099201df1c/1.png?v=1744298734775", // Level 0
                        "https://cdn.glitch.global/71030012-56ea-4d26-a426-e0099201df1c/1.png?v=1744298734775", // Level 1
                        "https://cdn.glitch.global/71030012-56ea-4d26-a426-e0099201df1c/2.png?v=1744298740440", // Level 2
                        "https://cdn.glitch.global/71030012-56ea-4d26-a426-e0099201df1c/3.png?v=1744298743347", // Level 3
                        "https://cdn.glitch.global/71030012-56ea-4d26-a426-e0099201df1c/4.png?v=1744298746733", // Level 4
                        "https://cdn.glitch.global/71030012-56ea-4d26-a426-e0099201df1c/5.png?v=1744298748767", // Level 5
                        "https://cdn.glitch.global/71030012-56ea-4d26-a426-e0099201df1c/6.png?v=1744298751393"  // Level 6
                    ];
                    
                    // Logic ch·ªçn ·∫£nh: N·∫øu level v∆∞·ª£t qu√° m·∫£ng th√¨ l·∫•y ·∫£nh cu·ªëi c√πng
                    let lv = treeData.treeLevel || 0;
                    if (lv >= treeImages.length) lv = treeImages.length - 1;
                    let currentTreeImg = treeImages[lv];
                %>
                <img src="<%= currentTreeImg %>" class="tree-img" id="treeImgAnim">
            </div>

            <div class="tree-info">
                <h2>C√¢y c·ªßa <%= treeData.username %></h2>
                
                <% 
                    let percent = 0;
                    let nextPoints = treeData.pointsForNextLevel;
                    let currentPoints = treeData.growthPoints;
                    let prevPoints = treeData.pointsForCurrentLevel;
                    
                    if (nextPoints !== Infinity) {
                        percent = Math.max(0, Math.min(100, ((currentPoints - prevPoints) / (nextPoints - prevPoints)) * 100));
                    } else {
                        percent = 100; // Max level
                    }
                %>

                <div class="progress-container">
                    <div class="progress-bar" style="width: <%= percent %>%"></div>
                    <div class="progress-text">
                        <%= currentPoints %> / <%= nextPoints === Infinity ? 'MAX' : nextPoints %> XP
                    </div>
                </div>
                
                <p class="motivation-text">
                    <% if (percent < 50) { %>
                        üå± C√¢y c·∫ßn n∆∞·ªõc! H√£y l√†m th√™m b√†i t·∫≠p nh√©!
                    <% } else if (percent < 90) { %>
                        üåø S·∫Øp l·ªõn r·ªìi, c·ªë l√™n b·∫°n ∆°i!
                    <% } else { %>
                        üå≥ Tuy·ªát v·ªùi! Chu·∫©n b·ªã ti·∫øn h√≥a!
                    <% } %>
                </p>

                <div style="margin-top: 30px;">
                    <a href="/subjects" class="btn btn-primary">ƒêi t∆∞·ªõi n∆∞·ªõc (H·ªçc b√†i)</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script>
    // Hi·ªáu ·ª©ng n·∫£y n·∫£y khi v√†o trang
    gsap.from("#treeImgAnim", {
        duration: 1.5,
        scale: 0.5,
        opacity: 0,
        y: 50,
        ease: "elastic.out(1, 0.3)",
        delay: 0.2
    });
    
    // Hi·ªáu ·ª©ng ch·∫°y thanh nƒÉng l∆∞·ª£ng
    gsap.from(".progress-bar", {
        width: "0%",
        duration: 1.5,
        ease: "power2.out",
        delay: 0.5
    });
</script>

<%- include('partials/footer') %>