<%- include('partials/header') %>
<link rel="stylesheet" href="/css/styleEditProfile.css">

<section class="edit-profile-section">
    <div class="container">
        <div style="text-align: center; margin-bottom: 40px;" data-animate="fade-down">
            <h1 style="font-size: 2.5rem; font-weight: 800; color: var(--dark-ink);">H·ªì S∆° C·ªßa B·∫°n üõ†Ô∏è</h1>
            <p style="color: #666;">C·∫≠p nh·∫≠t th√¥ng tin ƒë·ªÉ "ng·∫ßu" h∆°n tr√™n b·∫£ng x·∫øp h·∫°ng nh√©!</p>
        </div>

        <form action="/profile/edit" method="POST" enctype="multipart/form-data" class="edit-grid">
            
            <div class="profile-card avatar-zone">
                <div class="avatar-wrapper">
                    <img src="<%= user.avatar || 'https://cdn-icons-png.flaticon.com/512/847/847969.png' %>" 
                         class="avatar-preview" id="avatarPreview">
                    
                    <label for="avatarInput" class="camera-btn" title="ƒê·ªïi ·∫£nh">
                        <i class="fas fa-camera"></i>
                    </label>
                    <input type="file" id="avatarInput" name="avatar" accept="image/*" hidden>
                </div>

                <div class="user-display-name"><%= user.username %></div>
                <div class="user-role-badge">
                    <%= user.isPro ? 'üëë VIP Member' : 'üå± Newbie' %>
                </div>

                <% if (user.isPro) { %>
                    <a href="/pro-images" class="pro-link"><i class="fas fa-images"></i> Ch·ªçn t·ª´ Kho ·∫¢nh PRO</a>
                <% } %>
            </div>

            <div class="profile-card form-zone">
                <h3 class="card-title"><i class="fas fa-info-circle"></i> Th√¥ng Tin C√° Nh√¢n</h3>

                <div class="input-group-v3">
                    <label class="label-v3">Email li√™n h·ªá</label>
                    <input type="email" name="email" class="input-v3" value="<%= user.email || '' %>" placeholder="v√≠ d·ª•: tenban@gmail.com">
                </div>

                <div class="input-group-v3">
                    <label class="label-v3">Ti·ªÉu s·ª≠ (Bio)</label>
                    <textarea name="bio" class="input-v3 textarea-v3" placeholder="H√£y vi·∫øt g√¨ ƒë√≥ th·∫≠t 'ch·∫•t' v·ªÅ b·∫£n th√¢n..."><%= user.bio || '' %></textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="input-group-v3">
                        <label class="label-v3">L·ªõp</label>
                        <input type="text" name="class" class="input-v3" value="<%= user.class || '' %>" placeholder="VD: 12A1">
                    </div>
                    <div class="input-group-v3">
                        <label class="label-v3">Tr∆∞·ªùng</label>
                        <select name="school" class="input-v3">
                            <option value="" disabled <%= !user.school ? 'selected' : '' %>>Ch·ªçn tr∆∞·ªùng...</option>
                            <option value="THPT Th·ªß ƒê·ª©c" <%= user.school === 'THPT Th·ªß ƒê·ª©c' ? 'selected' : '' %>>THPT Th·ªß ƒê·ª©c</option>
                            <option value="THPT Nguy·ªÖn H·ªØu Hu√¢n" <%= user.school === 'THPT Nguy·ªÖn H·ªØu Hu√¢n' ? 'selected' : '' %>>THPT Nguy·ªÖn H·ªØu Hu√¢n</option>
                            <option value="Kh√°c" <%= user.school === 'Kh√°c' ? 'selected' : '' %>>Kh√°c...</option>
                        </select>
                    </div>
                </div>

                <div class="profile-card password-toggle-card" id="passwordCard">
                    <div class="toggle-header" id="pwToggleHeader">
                        <div class="toggle-title">
                            <i class="fas fa-lock-open"></i>
                            <h4>ƒê·ªïi M·∫≠t Kh·∫©u</h4>
                        </div>
                        <div class="toggle-status-icon">
                            <i class="fas fa-chevron-down toggle-arrow"></i>
                        </div>
                    </div>

                    <div id="pwFields" class="password-content">
                        <div class="input-group-v3">
                            <label class="label-v3">M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
                            <div class="password-wrapper">
                                <input type="password" name="currentPassword" class="input-v3" placeholder="Nh·∫≠p m·∫≠t kh·∫©u c≈©..." disabled>
                                <button type="button" class="eye-btn"><i class="fas fa-eye"></i></button>
                            </div>
                        </div>
                        <div class="input-group-v3">
                            <label class="label-v3">M·∫≠t kh·∫©u m·ªõi</label>
                            <div class="password-wrapper">
                                <input type="password" name="newPassword" class="input-v3" placeholder="T·ªëi thi·ªÉu 8 k√Ω t·ª±..." disabled>
                                <button type="button" class="eye-btn"><i class="fas fa-eye"></i></button>
                            </div>
                        </div>
                        <div class="input-group-v3">
                            <label class="label-v3">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
                            <input type="password" name="confirmNewPassword" class="input-v3" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi..." disabled>
                        </div>
                        <div id="pwMatchMessage" class="match-message"></div>
                    </div>
                </div>

                <div class="action-bar">
                    <a href="/profile" class="btn-cancel">H·ªßy</a>
                    <button type="submit" class="btn-save">
                        <i class="fas fa-save"></i> L∆∞u Thay ƒê·ªïi
                    </button>
                </div>
            </div>
        </form>
    </div>
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="/js/profileEditor.js"></script>

<%- include('partials/footer') %>