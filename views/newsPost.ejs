<%- include('partials/header') %>
<link rel="stylesheet" href="/css/styleNewsPost.css">
<link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />

<div class="newsroom-wrapper">
    
    <div class="newsroom-header">
        <div class="newsroom-title">üì∞ T√≤a So·∫°n HTTD</div>
        <p style="color: #666;">Spill the Tea (L√™n b√†i) cho c·∫£ tr∆∞·ªùng c√πng h√≥ng n√†o!</p>
    </div>

    <form action="<%= (mode === 'edit' && newsItem) ? '/news/' + newsItem._id + '/edit' : '/news/post' %>" 
          method="POST" 
          enctype="multipart/form-data" 
          class="news-editor-card" 
          id="newsForm">

        <div class="cover-section">
            
            <div class="thumb-switcher">
                <% if (user && user.isPro) { %>
                    <button type="button" class="thumb-tab active" onclick="switchThumbMode('upload')">
                        <i class="fas fa-cloud-upload-alt"></i> T·∫£i ·∫£nh l√™n
                    </button>
                    <button type="button" class="thumb-tab" onclick="switchThumbMode('url')">
                        <i class="fas fa-link"></i> D√°n Link ·∫£nh
                    </button>
                <% } else { %>
                    <button type="button" class="thumb-tab locked" onclick="window.location.href='/upgrade'" title="N√¢ng c·∫•p ƒë·ªÉ m·ªü kh√≥a">
                        <i class="fas fa-lock"></i> T·∫£i ·∫£nh (VIP)
                    </button>
                    <button type="button" class="thumb-tab active" onclick="switchThumbMode('url')">
                        <i class="fas fa-link"></i> D√°n Link ·∫£nh
                    </button>
                <% } %>
            </div>

            <div class="cover-upload-zone" id="coverZone">
                
                <% if (user && user.isPro) { %>
                    <div id="modeUpload" class="thumb-input-group active">
                        <input type="file" name="image" id="coverInput" accept="image/*" style="display: none;">
                        <div class="cover-placeholder" id="uploadPlaceholder">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; margin-bottom: 10px; color: #ccc;"></i>
                            <h3>K√©o th·∫£ ho·∫∑c Click ƒë·ªÉ t·∫£i ·∫£nh</h3>
                            <p>D√†nh ri√™ng cho th√†nh vi√™n PRO üëë</p>
                        </div>
                    </div>
                <% } %>

                <div id="modeUrl" class="thumb-input-group <%= (!user || !user.isPro) ? 'active' : '' %>" 
                    style="<%= (!user || !user.isPro) ? 'padding-top:40px' : 'width: 80%; margin: 0 auto; padding-top: 40px;' %>">
                    
                    <input type="text" name="imageUrl" id="urlInput" class="url-input" 
                        placeholder="Paste link ·∫£nh h·ª£p l·ªá v√†o ƒë√¢y (https://...)" 
                        autocomplete="off">
                    
                    <p style="text-align: center; color: #999; margin-top: 10px; font-size: 0.9rem;">
                        <% if (!user || !user.isPro) { %>
                            <i class="fas fa-info-circle"></i> B·∫°n ƒëang d√πng g√≥i mi·ªÖn ph√≠. <a href="/upgrade" style="color:var(--primary)">N√¢ng c·∫•p PRO</a> ƒë·ªÉ upload ·∫£nh tr·ª±c ti·∫øp.
                        <% } else { %>
                            Preview s·∫Ω hi·ªán ngay khi b·∫°n d√°n link.
                        <% } %>
                    </p>
                </div>

                <img src="<%= (newsItem && newsItem.image) ? newsItem.image : '' %>" 
                    class="cover-preview" 
                    id="coverPreview" 
                    style="<%= (newsItem && newsItem.image) ? 'display:block' : 'display:none' %>">
                
                <button type="button" class="btn-remove-cover" id="btnRemoveCover" 
                        style="<%= (newsItem && newsItem.image) ? 'display:flex' : 'display:none' %>">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>

        <input type="text" name="title" class="news-title-input" 
               placeholder="Nh·∫≠p ti√™u ƒë·ªÅ h√≥t h√≤n h·ªçt..." 
               value="<%= newsItem ? newsItem.title : '' %>" required autocomplete="off">

        <label class="cat-label">Ch·ªçn Team (Chuy√™n m·ª•c)</label>
        <div class="cat-selector">
            <label class="cat-option">
                <input type="radio" name="category" value="H·ªçc t·∫≠p" <%= (!newsItem || newsItem.category === 'H·ªçc t·∫≠p') ? 'checked' : '' %>>
                <div class="cat-chip"><i class="fas fa-book"></i> H·ªçc t·∫≠p</div>
            </label>
            <label class="cat-option">
                <input type="radio" name="category" value="Ho·∫°t ƒë·ªông" <%= (newsItem && newsItem.category === 'Ho·∫°t ƒë·ªông') ? 'checked' : '' %>>
                <div class="cat-chip"><i class="fas fa-running"></i> Ho·∫°t ƒë·ªông</div>
            </label>
            <label class="cat-option">
                <input type="radio" name="category" value="Tuy·ªÉn sinh" <%= (newsItem && newsItem.category === 'Tuy·ªÉn sinh') ? 'checked' : '' %>>
                <div class="cat-chip"><i class="fas fa-fire"></i> Tuy·ªÉn sinh</div>
            </label>
            <label class="cat-option">
                <input type="radio" name="category" value="Kh√°c" <%= (newsItem && newsItem.category === 'Kh√°c') ? 'checked' : '' %>>
                <div class="cat-chip"><i class="fas fa-hashtag"></i> Kh√°c</div>
            </label>
        </div>

        <label class="cat-label">N·ªôi dung chi ti·∫øt</label>
        <div id="newsContentEditor"></div>
        <input type="hidden" name="content" id="hiddenContentInput" value="<%= newsItem ? newsItem.content : '' %>">

        <div class="action-bar">
            <a href="/news" class="btn-cancel">H·ªßy</a>
            <button type="submit" class="btn-post" id="btnSubmit">
                <i class="fas fa-paper-plane"></i> <%= mode === 'edit' ? 'L∆∞u b√†i vi·∫øt' : 'ƒêƒÉng ngay üöÄ' %>
            </button>
        </div>

    </form>
</div>

<script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="/js/newsEditor.js"></script>

<%- include('partials/footer') %>