<%- include('partials/header') %>
<link rel="stylesheet" href="/css/styleProfile.css">

<div class="profile-wrapper">
    
    <div class="profile-grid">
        
        <aside class="bento-card identity-card">
            <div class="card-banner" style="background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%);"></div>
            
            <div class="id-avatar-wrapper">
                <img src="<%= targetUser.avatar || 'https://cdn-icons-png.flaticon.com/512/847/847969.png' %>" class="id-avatar">
                <% if(targetUser.isPro) { %> <div class="pro-badge" title="VIP">üëë</div> <% } %>
            </div>

            <div class="id-content">
                <h1 class="id-name"><%= targetUser.username %></h1>
                <span class="id-username">@<%= targetUser.username.toLowerCase().replace(/\s+/g, '') %></span>

                <div class="id-bio">
                    "<%= targetUser.bio || 'Th√†nh vi√™n n√†y r·∫•t b√≠ ·∫©n...' %>"
                </div>

                <div class="id-tags">
                    <div class="tag-pill"><i class="fas fa-graduation-cap"></i> <%= targetUser.class || 'L·ªõp ?' %></div>
                    <div class="tag-pill"><i class="fas fa-school"></i> <%= targetUser.school || 'THPT Th·ªß ƒê·ª©c' %></div>
                </div>

                <button class="btn-action btn-secondary" onclick="copyProfileLink()">
                    <i class="fas fa-share-alt"></i> Share Profile
                </button>
            </div>
        </aside>

        <main>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-val"><%= new Date(targetUser.createdAt).toLocaleDateString('vi-VN') %></div>
                    <div class="stat-label">üìÖ Tham gia</div>
                </div>
                <div class="stat-card">
                    <div class="stat-val"><%= targetUser.points || 0 %></div>
                    <div class="stat-label">ü™ô ƒêi·ªÉm S·ªë</div>
                </div>
                <div class="stat-card">
                    <div class="stat-val">Lv.<%= targetUser.level || 1 %></div>
                    <div class="stat-label">C·∫•p ƒë·ªô</div>
                </div>
            </div>

            <div class="bento-card tree-section">
                <div class="tree-info">
                    <h3>üå≥ V∆∞·ªùn C·ªßa <%= targetUser.username %></h3>
                    <div style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">
                        ƒêang ·ªü c·∫•p ƒë·ªô: <b><%= targetUser.level || 1 %> üåü</b>
                    </div>
                    
                    <a href="/my-garden/visit/<%= targetUser._id %>" class="btn-visit" style="background: #2d3436; color: white; border: none;">
                        üöÄ Gh√© thƒÉm nh√† b·∫°n ·∫•y
                    </a>
                </div>
                <div class="tree-visual">
                    <img src="https://cdn-icons-png.flaticon.com/512/10537/10537169.png" style="width: 90px; filter: drop-shadow(4px 4px 0 rgba(0,0,0,0.1));">
                </div>
            </div>

            <% if (targetUser.achievements && targetUser.achievements.length > 0) { %>
            <div class="bento-card activity-box" style="margin-top: 25px;">
                <h3 style="font-size: 1.3rem; margin-bottom: 15px; font-weight: 800;">üèÖ Huy Hi·ªáu ƒê·∫°t ƒê∆∞·ª£c</h3>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <% targetUser.achievements.forEach(ach => { %>
                        <div style="text-align: center;" title="<%= ach.name %>">
                            <img src="<%= ach.icon %>" style="width: 50px; height: 50px; border-radius: 50%; border: 2px solid #eee; padding: 2px; box-shadow: 2px 2px 0 rgba(0,0,0,0.1);">
                        </div>
                    <% }) %>
                </div>
            </div>
            <% } %>

        </main>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const runViewAnimations = () => {
            if (typeof gsap === 'undefined') return;

            gsap.fromTo(".identity-card", 
                { x: -50, opacity: 0, visibility: 'hidden' },
                { x: 0, opacity: 1, visibility: 'visible', duration: 0.8, ease: "power2.out" }
            );

            gsap.fromTo(".stat-card", 
                { y: 30, opacity: 0, visibility: 'hidden' },
                { y: 0, opacity: 1, visibility: 'visible', duration: 0.6, stagger: 0.1, delay: 0.2, ease: "back.out(1.7)" }
            );

            gsap.fromTo(".bento-card:not(.identity-card)", 
                { y: 50, opacity: 0, visibility: 'hidden' },
                { y: 0, opacity: 1, visibility: 'visible', duration: 0.8, stagger: 0.2, delay: 0.1, ease: "power2.out" }
            );
        };

        if (typeof gsap !== 'undefined') {
            runViewAnimations();
        } else {
            const checkInterval = setInterval(() => {
                if (typeof gsap !== 'undefined') {
                    clearInterval(checkInterval);
                    runViewAnimations();
                }
            }, 50);

            setTimeout(() => {
                clearInterval(checkInterval);
                document.querySelectorAll('.stat-card, .bento-card, .identity-card').forEach(el => {
                    el.style.opacity = '1';
                    el.style.visibility = 'visible';
                    el.style.transform = 'none';
                });
            }, 3000);
        }
    });

    function copyProfileLink() {
        const url = window.location.href;
        navigator.clipboard.writeText(url).then(() => {
            alert("ƒê√£ sao ch√©p link h·ªì s∆°!");
        }).catch(err => {
            console.error('L·ªói sao ch√©p: ', err);
        });
    }
</script>

<%- include('partials/footer') %>