<%- include('partials/header') %>
<link rel="stylesheet" href="/css/styleProfile.css">

<div class="profile-wrapper">
    
    <div class="profile-grid">
        
        <aside class="bento-card identity-card">
            <div class="id-avatar-wrapper">
                <img src="<%= targetUser.avatar || 'https://cdn-icons-png.flaticon.com/512/847/847969.png' %>" class="id-avatar">
                <% if(targetUser.isPro) { %>
                    <div class="pro-badge" title="TÃ i khoáº£n VIP">ğŸ‘‘</div>
                <% } %>
            </div>

            <h1 class="id-name"><%= targetUser.username %></h1>
            <p class="id-username">@<%= targetUser.username.toLowerCase().replace(/\s+/g, '') %></p>

            <div class="id-meta">
                <span class="meta-tag"><i class="fas fa-graduation-cap"></i> <%= targetUser.class || 'Lá»›p ?' %></span>
                <span class="meta-tag"><i class="fas fa-school"></i> <%= targetUser.school || 'THPT Thá»§ Äá»©c' %></span>
            </div>

            <div class="id-bio">
                "<%= targetUser.bio || 'ThÃ nh viÃªn nÃ y ráº¥t bÃ­ áº©n, chÆ°a viáº¿t tiá»ƒu sá»­...' %>"
            </div>

            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                <button class="btn-action secondary" onclick="copyProfileLink()">
                    <i class="fas fa-share-alt"></i> Sao chÃ©p Link
                </button>
            </div>
        </aside>

        <main class="main-info">
            
            <div class="stats-grid">
                <div class="stat-box">
                    <h3><%= new Date(targetUser.createdAt).toLocaleDateString('vi-VN') %></h3>
                    <p>ğŸ“… NgÃ y gia nháº­p</p>
                </div>
                <div class="stat-box">
                    <h3><%= targetUser.growthPoints || 0 %></h3>
                    <p>ğŸŒ± Äiá»ƒm TÃ­ch LÅ©y</p>
                </div>
                <div class="stat-box">
                    <h3>
                        <% if (targetUser.role === 'admin') { %> Admin ğŸ›¡ï¸
                        <% } else if (targetUser.isTeacher) { %> GiÃ¡o ViÃªn ğŸ“
                        <% } else if (targetUser.isPro) { %> VIP Member ğŸ‘‘
                        <% } else { %> Há»c Sinh âœï¸ <% } %>
                    </h3>
                    <p>ğŸ”° Vai trÃ²</p>
                </div>
            </div>

            <div class="bento-card tree-section">
                <div class="tree-info">
                    <h3>ğŸŒ³ VÆ°á»n Cá»§a <%= targetUser.username %></h3>
                    <p style="color: #666; margin-bottom: 10px;">
                        Äang chÄƒm sÃ³c cÃ¢y vá»›i táº¥t cáº£ sá»± ná»— lá»±c!
                    </p>
                    <div style="background: #f0fdf4; padding: 10px; border-radius: 8px; display: inline-block; color: #166534; font-weight: 600;">
                        Cáº¥p Ä‘á»™ hiá»‡n táº¡i: <%= targetUser.treeLevel || 1 %> ğŸŒŸ
                    </div>
                </div>
                <div class="tree-visual">
                    <% 
                        let treeImg = 'https://cdn-icons-png.flaticon.com/512/2924/2924900.png'; // CÃ¢y máº·c Ä‘á»‹nh
                        if ((targetUser.treeLevel || 1) >= 5) treeImg = 'https://cdn-icons-png.flaticon.com/512/628/628283.png'; // CÃ¢y to hÆ¡n
                        if ((targetUser.treeLevel || 1) >= 10) treeImg = 'https://cdn-icons-png.flaticon.com/512/2424/2424773.png'; // CÃ¢y cá»• thá»¥
                    %>
                    <img src="<%= treeImg %>" alt="Tree" style="width: 120px; height: 120px; object-fit: contain;"> 
                </div>
            </div>

            <% if (targetUser.achievements && targetUser.achievements.length > 0) { %>
            <div class="bento-card" style="margin-top: 20px;">
                <h3>ğŸ… Huy Hiá»‡u Äáº¡t ÄÆ°á»£c</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px;">
                    <% targetUser.achievements.forEach(ach => { %>
                        <div class="badge-item" title="<%= ach.name %>">
                            <img src="<%= ach.icon %>" style="width: 40px; height: 40px;">
                        </div>
                    <% }) %>
                </div>
            </div>
            <% } %>

        </main>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script>
    // Animation Ä‘Æ¡n giáº£n khi vÃ o trang
    gsap.from(".bento-card, .stat-box", {
        duration: 0.6,
        y: 30,
        opacity: 0,
        stagger: 0.1,
        ease: "power2.out"
    });

    function copyProfileLink() {
        const url = window.location.href;
        navigator.clipboard.writeText(url).then(() => {
            alert("ÄÃ£ sao chÃ©p link há»“ sÆ¡!");
        }).catch(err => {
            console.error('Lá»—i sao chÃ©p: ', err);
        });
    }
</script>

<%- include('partials/footer') %>