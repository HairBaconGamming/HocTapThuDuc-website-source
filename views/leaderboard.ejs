<%- include('partials/header') %>
<link rel="stylesheet" href="/css/styleLeaderboard.css">

<div class="leaderboard-wrapper">
    
    <div class="lb-header" data-animate="fade-down">
        <h1 class="lb-title">üèÜ ƒê·∫•u Tr∆∞·ªùng Danh V·ªçng</h1>
        <p style="color: #666;">Vinh danh nh·ªØng chi·∫øn th·∫ßn chƒÉm ch·ªâ nh·∫•t Server</p>
    </div>

    <div class="podium-container">
        
        <% if(top3[1]) { %>
            <a href="/profile/view/<%= top3[1]._id %>" class="podium-link rank-2">
                <div class="podium-item">
                    <div class="podium-avatar-box">
                        <img src="<%= top3[1].avatar || '/default.png' %>" class="podium-avatar">
                    </div>
                    <div class="podium-name"><%= top3[1].username %></div>
                    <div class="podium-points"><%= top3[1].points %> pts</div>
                    <div class="podium-block">2</div>
                </div>
            </a>
        <% } %>

        <% if(top3[0]) { %>
            <a href="/profile/view/<%= top3[0]._id %>" class="podium-link rank-1">
                <div class="podium-item">
                    <div class="podium-avatar-box">
                        <div class="crown">üëë</div>
                        <img src="<%= top3[0].avatar || '/default.png' %>" class="podium-avatar">
                    </div>
                    <div class="podium-name">
                        <%= top3[0].username %> 
                        <% if(top3[0].isPro) { %><span class="pro-tag">PRO</span><% } %>
                    </div>
                    <div class="podium-points"><%= top3[0].points %> pts</div>
                    <div class="podium-block">1</div>
                </div>
            </a>
        <% } %>

        <% if(top3[2]) { %>
            <a href="/profile/view/<%= top3[2]._id %>" class="podium-link rank-3">
                <div class="podium-item">
                    <div class="podium-avatar-box">
                        <img src="<%= top3[2].avatar || '/default.png' %>" class="podium-avatar">
                    </div>
                    <div class="podium-name"><%= top3[2].username %></div>
                    <div class="podium-points"><%= top3[2].points %> pts</div>
                    <div class="podium-block">3</div>
                </div>
            </a>
        <% } %>

    </div>

    <div class="rank-list">
        <% restOfList.forEach((u, idx) => { %>
            <a href="/profile/view/<%= u._id %>" class="rank-link">
                <div class="rank-card">
                    <div class="rank-num">#<%= idx + 4 %></div>
                    <img src="<%= u.avatar || '/default.png' %>" class="rank-avatar">
                    <div class="rank-info">
                        <div class="rank-name">
                            <%= u.username %>
                            <% if(u.isPro) { %><span class="pro-tag">PRO</span><% } %>
                        </div>
                        <div style="font-size: 0.8rem; color: #888;"><%= u.class || 'L·ªõp ?' %></div>
                    </div>
                    <div class="rank-score"><%= u.points %> <span style="font-size:0.7rem; font-weight:400; color:#aaa;">pts</span></div>
                </div>
            </a>
        <% }) %>

        <% if(restOfList.length === 0 && top3.length === 0) { %>
            <div style="text-align: center; color: #999; padding: 20px;">
                <i class="fas fa-ghost"></i> Ch∆∞a c√≥ d·ªØ li·ªáu x·∫øp h·∫°ng.
            </div>
        <% } %>
    </div>

</div>

<% if (user && myRank) { %>
    <a href="/profile" style="text-decoration: none;"> <div class="sticky-rank-bar">
            <div class="sticky-left">
                <div class="my-rank-badge">#<%= myRank %></div>
                <img src="<%= user.avatar || '/default.png' %>" class="my-avatar-circle">
                <div class="my-info">
                    <span class="my-label">H·∫°ng c·ªßa b·∫°n</span>
                    <span class="my-name"><%= user.username %></span>
                </div>
            </div>
            <div class="sticky-right">
                <div class="my-points-box">
                    <%= user.points %> pts
                </div>
            </div>
        </div>
    </a>
<% } %>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const safeAnimate = (selector, fromVars, toVars) => {
            const els = document.querySelectorAll(selector);
            if(els.length === 0) return;
            if(typeof gsap === 'undefined') {
                els.forEach(el => { el.style.opacity='1'; el.style.transform='none'; el.style.visibility='visible'; });
                return;
            }
            gsap.fromTo(els, fromVars, { ...toVars, clearProps: 'all' });
        };

        // Animation config
        safeAnimate('.podium-item', { y: 100, opacity: 0 }, { y: 0, opacity: 1, duration: 1, stagger: 0.2, ease: 'elastic.out(1, 0.5)' });
        safeAnimate('.rank-card', { x: -20, opacity: 0 }, { x: 0, opacity: 1, duration: 0.5, stagger: 0.05, delay: 0.5 });
        safeAnimate('.lb-header', { y: -30, opacity: 0 }, { y: 0, opacity: 1, duration: 0.8 });
    });
</script>

<%- include('partials/footer') %>