<%- include('partials/header') %>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<link rel="stylesheet" href="/css/styleDiscussion.css">

<div class="discussion-wrapper">
    <div class="discussion-header">
        <a href="/lesson/<%= lesson._id %>" class="back-btn">
            <i class="fas fa-arrow-left"></i> Quay l·∫°i b√†i h·ªçc
        </a>
        <h1>üí¨ <%= lesson.title %></h1>
        <div class="header-meta">
            <div class="meta-item">
                <i class="fas fa-user"></i>
                <span>T√°c gi·∫£: <strong><%= lesson.createdBy ? lesson.createdBy.username : 'Admin' %></strong></span>
            </div>
            <div class="meta-item">
                <i class="fas fa-calendar"></i>
                <span><%= new Date(lesson.createdAt).toLocaleDateString('vi-VN') %></span>
            </div>
        </div>
    </div>

    <div class="comment-form">
        <div class="form-title">
            <i class="fas fa-pen"></i> ƒê·ªÉ l·∫°i b√¨nh lu·∫≠n
        </div>
        <div class="form-group">
            <textarea 
                id="comment-text" 
                placeholder="Chia s·∫ª √Ω ki·∫øn, ƒë·∫∑t c√¢u h·ªèi ho·∫∑c th·∫£o lu·∫≠n v·ªÅ b√†i h·ªçc n√†y..." 
                maxlength="5000"></textarea>
        </div>
        <div class="form-footer">
            <span class="char-info"><span id="char-count">0</span>/5000</span>
            <button type="button" class="submit-btn" id="btn-submit" onclick="discussion.submitComment()">G·ª≠i b√¨nh lu·∫≠n</button>
        </div>
    </div>

    <div class="comments-container">
        <div class="comments-header">
            <div class="comments-title">
                Th·∫£o lu·∫≠n c·ªông ƒë·ªìng
                <span class="comment-count">(<span id="total-count">0</span>)</span>
            </div>
        </div>
        
        <div id="comments-list">
            <div class="loading-state">
                <div class="spinner"></div>
                <div class="loading-text">ƒêang t·∫£i...</div>
            </div>
        </div>
    </div>
</div>

<script>
    window.LESSON_ID = '<%= lesson._id %>';
    window.AUTHOR_USERNAME = '<%= lesson.createdBy ? lesson.createdBy.username : "" %>';
    window.USER = <% if(user) { %>
        <%- JSON.stringify({ id: user._id, username: user.username, avatar: user.avatar }) %>
    <% } else { %> null <% } %>;
</script>

<script src="/js/discussion.js"></script>

<%- include('partials/footer') %>