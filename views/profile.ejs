<%- include('partials/header') %>
<link rel="stylesheet" href="/css/styleProfile.css">

<div class="profile-wrapper">
    
    <div class="bento-grid">
        
        <div class="bento-card identity-card">
            <div class="avatar-wrapper">
                <img src="<%= profileUser.avatar || 'https://cdn-icons-png.flaticon.com/512/847/847969.png' %>" class="avatar-img" alt="Avatar">
                <div class="level-badge">Lv.<%= levelInfo.level %></div>
            </div>
            
            <h1 class="user-name"><%= profileUser.username %></h1>
            
            <span class="user-role">
                <%= isOwner ? 'Ch·ªß nh√¢n üè†' : 'Kh√°ch gh√© thƒÉm üëã' %>
            </span>

            <div class="bio-box">
                <%= profileUser.bio || "Ch∆∞a c√≥ l·ªùi gi·ªõi thi·ªáu n√†o. M·ªôt ng∆∞·ªùi b√≠ ·∫©n..." %>
            </div>

            <% if (isOwner) { %>
            <div class="action-buttons">
                <a href="/profile/edit" class="btn-chill btn-edit">
                    <i class="fas fa-pen"></i> S·ª≠a
                </a>
                <a href="/logout" class="btn-chill btn-logout">
                    <i class="fas fa-sign-out-alt"></i> Tho√°t
                </a>
            </div>
            <% } %>
        </div>

        <div class="bento-card realm-card">
            <div class="realm-header">
                <div>
                    <div class="realm-label">C·∫£nh gi·ªõi hi·ªán t·∫°i</div>
                    <div class="realm-name"><%= levelInfo.fullName %></div>
                </div>
                <div class="realm-icon">‚ö°</div>
            </div>

            <div class="xp-section">
                <div class="xp-track">
                    <div class="xp-fill" style="width: <%= levelInfo.progress %>%"></div>
                </div>
                
                <div class="xp-stats">
                    <span><%= levelInfo.progress %>%</span>
                    <span><%= levelInfo.currentXP.toLocaleString() %> / <%= levelInfo.requiredXP.toLocaleString() %> XP</span>
                </div>
            </div>
        </div>

        <div class="stats-container">
            <div class="mini-stat gold">
                <div class="stat-emoji">üí∞</div>
                <div class="stat-num"><%= stats.gold.toLocaleString() %></div>
                <div class="stat-title">V√†ng</div>
            </div>
            <div class="mini-stat points">
                <div class="stat-emoji">üçÄ</div>
                <div class="stat-num"><%= stats.points.toLocaleString() %></div>
                <div class="stat-title">ƒêi·ªÉm</div>
            </div>
            <div class="mini-stat lessons">
                <div class="stat-emoji">üìö</div>
                <div class="stat-num"><%= stats.lessons %></div>
                <div class="stat-title">B√†i h·ªçc</div>
            </div>
        </div>

        <a href="<%= isOwner ? '/my-garden' : '/my-garden/visit/' + profileUser._id %>" class="bento-card garden-link-card">
            <div class="garden-content">
                <div><%= isOwner ? 'V·ªÅ N√¥ng Tr·∫°i' : 'Gh√© thƒÉm V∆∞·ªùn' %></div>
                <div>Tr·ªìng c√¢y, nu√¥i c√°, chill... üå±</div>
            </div>
            <div class="garden-arrow">‚ûî</div>
        </a>

        <div class="bento-card activity-card">
            <div class="activity-header">
                <span>üî• Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y</span>
            </div>
            
            <div class="activity-list">
                <% if (activities && activities.length > 0) { %>
                    <% activities.forEach(activity => { %>
                        <div class="activity-item">
                            <div class="act-icon">üìù</div>
                            <div class="act-info">
                                <div class="act-title">ƒê√£ h·ªçc xong: <%= activity.lessonId ? activity.lessonId.title : 'B√†i h·ªçc ·∫©n' %></div>
                                <div class="act-time">
                                    <%= moment(activity.completedAt).fromNow() %>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                <% } else { %>
                    <div style="text-align:center; padding:20px; color:#94a3b8; font-style:italic;">
                        "Im ·∫Øng qu√°... Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o." üçÉ
                    </div>
                <% } %>
            </div>
        </div>

    </div>
</div>

<script>
    // Animation nh·∫π cho thanh XP khi load
    document.addEventListener("DOMContentLoaded", () => {
        const bar = document.querySelector('.xp-pill-fill');
        if(bar) {
            const w = bar.style.width;
            bar.style.width = '0%';
            setTimeout(() => bar.style.width = w, 300);
        }
    });
</script>

<%- include('partials/footer') %>