<%- include('partials/header') %>

<link rel="stylesheet" href="/css/styleIndex.css">
<link rel="stylesheet" href="/css/styleSubjects.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

<div class="subjects-page-header">
    <div class="hero-bg-shape shape-1" style="top: -60%; right: -20%; background: var(--primary-light);"></div>
    <div class="hero-bg-shape shape-2" style="bottom: -40%; left: -20%; background: var(--accent-red); opacity: 0.15;"></div>

    <div class="reveal-holder creative-reveal-up relative z-10">
        <span class="section-tag">Hành trang tri thức</span>
        <h1 class="hero-title text-4xl md:text-5xl">Danh Mục Môn Học</h1>
        <p class="hero-desc mt-4 max-w-2xl mx-auto">
            Hệ thống kiến thức được phân loại khoa học, giúp bạn dễ dàng tiếp cận và chinh phục từng môn học.
        </p>
    </div>
</div>

<div class="subjects-wrapper">
    
    <div class="subject-controls reveal-holder creative-reveal-scale" style="transition-delay: 0.2s">
        <div class="search-box-modern">
            <div class="search-icon-box"><i class="fas fa-search"></i></div>
            <input type="text" id="subjectSearch" class="search-input-field" placeholder="Nhập tên môn học bạn muốn tìm...">
            <button class="btn-filter-toggle"><i class="fas fa-arrow-right"></i></button>
        </div>
    </div>

    <div class="subjects-grid" id="subjectsGrid">
        
        <% if (subjects && subjects.length > 0) { %>
            <% subjects.forEach((sub, index) => { %>
                <a href="/subjects/<%= sub._id %>" class="subject-item-card reveal-holder creative-reveal-up" style="transition-delay: <%= index * 100 %>ms">
                    
                    <div class="sub-thumb-wrapper">
                        <img src="<%= sub.image || 'https://i.ibb.co/K236w2f/default-subject.png' %>" 
                             alt="<%= sub.name %>" 
                             class="sub-thumb-img"
                             onerror="this.onerror=null;this.src='https://i.ibb.co/K236w2f/default-subject.png';">
                    </div>
                    
                    <h3 class="sub-title"><%= sub.name %></h3>
                    
                    <p class="sub-desc">
                        <%= sub.description || 'Khám phá kho tàng kiến thức và tài liệu ôn tập chất lượng cho môn ' + sub.name + '.' %>
                    </p>
                    
                    <div class="sub-footer">
                        <span class="course-count-badge">
                            <i class="fas fa-layer-group me-1"></i> <%= sub.courseCount || 0 %> khóa học
                        </span>
                        <div class="btn-sub-go">
                            <i class="fas fa-angle-right"></i>
                        </div>
                    </div>
                </a>
            <% }) %>
        <% } else { %>
            <div class="empty-state-subject">
                <img src="https://cdni.iconscout.com/illustration/premium/thumb/empty-folder-4064360-3363921.png" class="empty-img" alt="Empty">
                <h3 class="text-xl font-bold text-dark">Chưa có môn học nào</h3>
                <p class="text-gray-500 mt-2">Dữ liệu đang được cập nhật. Vui lòng quay lại sau!</p>
            </div>
        <% } %>

    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(e => {
                if(e.isIntersecting) { e.target.classList.add('active'); observer.unobserve(e.target); }
            });
        }, { threshold: 0.1 });
        document.querySelectorAll('.reveal-holder').forEach(el => observer.observe(el));

        const searchInput = document.getElementById('subjectSearch');
        if(searchInput) {
            searchInput.addEventListener('keyup', function() {
                const val = this.value.toLowerCase().trim();
                const cards = document.querySelectorAll('.subject-item-card');
                let hasVisible = false;
                cards.forEach(card => {
                    const name = card.querySelector('.sub-title').innerText.toLowerCase();
                    if(name.includes(val)) {
                        card.style.display = 'flex';
                        card.classList.remove('active'); setTimeout(() => card.classList.add('active'), 50);
                        hasVisible = true;
                    } else { card.style.display = 'none'; }
                });
            });
        }
    });
</script>

<%- include('partials/footer') %>