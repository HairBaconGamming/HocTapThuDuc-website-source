<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= typeof title !== 'undefined' ? title : 'Học Tập Thủ Đức' %> ✨</title>
    <link rel="icon" type="image/png" href="https://cdn.glitch.global/71030012-56ea-4d26-a426-e0099201df1c/823029_library_512x512.png?v=1741523759119">

    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/styleHeader.css">
    
    <% if (typeof activePage !== 'undefined' && (activePage === 'login' || activePage === 'register')) { %>
        <link rel="stylesheet" href="/css/styleLogin.css">
    <% } %>
</head>
<body class="<%= typeof activePage !== 'undefined' ? activePage : '' %>">

<header class="header" id="mainHeader">
    <nav class="navbar">
        <a href="/" class="logo">
            <img src="https://cdn.glitch.global/71030012-56ea-4d26-a426-e0099201df1c/823029_library_512x512.png?v=1741523759119" alt="Logo" class="logo-img">
            <span class="logo-text">HTTD</span>
        </a>

        <button class="mobile-nav-toggle" id="mobileNavToggle" aria-label="Menu">
            <span class="hamburger-icon"></span>
        </button>

        <ul class="nav-menu" id="navMenu">
            <li class="nav-item <%= activePage === 'home' ? 'active' : '' %>">
                <a href="/" class="nav-link"><i class="fas fa-home icon"></i> Sân trường</a>
            </li>
            <li class="nav-item <%= activePage === 'subjects' ? 'active' : '' %>">
                <a href="/subjects" class="nav-link"><i class="fas fa-book icon"></i> Kho bí kíp</a>
            </li>
            
            <li class="nav-item has-dropdown <%= ['news', 'newsPost'].includes(activePage) ? 'active' : '' %>">
                <a href="/news" class="nav-link">
                    <i class="far fa-newspaper icon"></i> Hóng biến <i class="fas fa-chevron-down dropdown-indicator"></i>
                </a>
                <div class="dropdown-menu">
                    <a href="/news" class="tool-dropdown-link"><i class="fas fa-eye"></i> <span>Lướt NewsFeed</span></a>
                    <% if (user && user.isPro) { %>
                        <a href="/news/post" class="tool-dropdown-link"><i class="fas fa-pen-nib"></i> <span>Lên bài ngay (Spill Tea)</span></a>
                    <% } %>
                </div>
            </li>

            <li class="nav-item has-dropdown <%= ['live', 'leaderboard'].includes(activePage) ? 'active' : '' %>">
                <a href="#" class="nav-link">
                    <i class="fas fa-rocket icon"></i> Đồ chơi <i class="fas fa-chevron-down dropdown-indicator"></i>
                </a>
                <div class="dropdown-menu">
                    <a href="/lesson/add" class="tool-dropdown-link loading-link <%= activePage === 'lessonAdd' ? 'active' : '' %>"> <i class="fa-solid fa-share-from-square icon"></i> <span>Share bí kíp</span> </a>
                    <a href="/live" class="tool-dropdown-link"><i class="fas fa-broadcast-tower"></i> <span>Lên sóng (Live)</span></a>
                    <a href="/leaderboard" class="tool-dropdown-link"><i class="fas fa-trophy"></i> <span>Đua Top Server</span></a>
                    <% if (user && user.isPro) { %>
                        <a href="/pro-images" class="tool-dropdown-link"><i class="fas fa-images"></i> <span>Kho ảnh xịn</span></a>
                    <% } else { %>
                        <a href="/upgrade" class="tool-dropdown-link"><i class="fas fa-crown" style="color: gold;"></i> <span>Nâng cấp VIP</span></a>
                    <% } %>
                </div>
            </li>

            <% if (user) { %>
                <li class="nav-item has-dropdown user-dropdown <%= activePage === 'profile' ? 'active' : '' %>">
                    <a href="/profile" class="nav-link user-link" style="padding-right: 10px;">
                        <img src="<%= user.avatar || 'https://cdn-icons-png.flaticon.com/512/847/847969.png' %>" class="user-avatar-img">
                        <span><%= user.username %></span>
                        <% if(user.isPro) { %> <i class="fas fa-check-circle" style="color: #a2d2ff; font-size: 0.8rem; margin-left: 3px;" title="Tài khoản xịn"></i> <% } %>
                    </a>
                    <div class="dropdown-menu">
                        <a href="/dashboard" class="tool-dropdown-link"><i class="fas fa-gamepad"></i> <span>Căn cứ địa (Dashboard)</span></a>
                        <a href="/profile" class="tool-dropdown-link"><i class="fas fa-id-card"></i> <span>Check Info</span></a>
                        <a href="/my-tree" class="tool-dropdown-link"><i class="fas fa-leaf"></i> <span>Chăm cây cưng</span></a>
                        <div style="border-top: 1px solid #eee; margin: 5px 0;"></div>
                        <a href="/logout" class="tool-dropdown-link" style="color: #ff6b6b;"><i class="fas fa-running"></i> <span>Sủi thôi (Out)</span></a>
                    </div>
                </li>
            <% } else { %>
                <li class="nav-item">
                    <a href="/login" class="nav-link" style="background: var(--primary); color: white; padding: 10px 25px; box-shadow: 0 4px 10px rgba(162, 210, 255, 0.4);">
                        ✨ Điểm danh
                    </a>
                </li>
            <% } %>
        </ul>
    </nav>
</header>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // 1. Scroll Effect
        const header = document.getElementById('mainHeader');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 50) header.classList.add('scrolled');
            else header.classList.remove('scrolled');
        });

        // 2. Mobile Menu Toggle
        const mobileToggle = document.getElementById('mobileNavToggle');
        const navMenu = document.getElementById('navMenu');
        
        mobileToggle?.addEventListener('click', () => {
            mobileToggle.classList.toggle('active');
            navMenu.classList.toggle('active');
        });

        // 3. Mobile Dropdown Toggle (Click thay vì Hover trên mobile)
        const dropdowns = document.querySelectorAll('.has-dropdown');
        dropdowns.forEach(item => {
            const link = item.querySelector('.nav-link');
            link.addEventListener('click', (e) => {
                if (window.innerWidth <= 992) {
                    e.preventDefault(); // Chặn link chính khi ở mobile để mở menu con
                    item.classList.toggle('dropdown-active');
                }
            });
        });

        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
            if (!header.contains(e.target)) {
                mobileToggle?.classList.remove('active');
                navMenu?.classList.remove('active');
            }
        });
    });
</script>

<main class="main-content" style="padding-top: 100px;">