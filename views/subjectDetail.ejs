<%- include('partials/header') %>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
    :root {
        --primary: #3b82f6;
        --dark: #1f2937;
        --light: #f3f4f6;
        --gray: #6b7280;
    }

    body { background-color: #f8fafc; font-family: 'Inter', sans-serif; color: var(--dark); }

    /* --- HERO SECTION --- */
    .subject-hero {
        background: white;
        border-bottom: 1px solid #e5e7eb;
        padding: 60px 0;
        margin-bottom: 40px;
    }
    .hero-container {
        max-width: 1200px;
        margin: 0 auto; padding: 0 20px;
        display: flex; align-items: center; gap: 40px;
    }
    .subject-thumb-lg {
        width: 150px; height: 150px; border-radius: 20px;
        object-fit: cover;
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
    }
    .subject-info h1 { font-size: 2.5rem; font-weight: 800; color: #111827; margin-bottom: 15px; }
    .subject-desc { font-size: 1.1rem; color: var(--gray); max-width: 700px; line-height: 1.6; }
    
    .stats-row { display: flex; gap: 25px; margin-top: 20px; color: var(--gray); font-weight: 500; }
    .stat-badge { display: flex; align-items: center; gap: 8px; background: #f3f4f6; padding: 6px 12px; border-radius: 8px; font-size: 0.9rem; }

    /* --- COURSE GRID --- */
    .container { max-width: 1200px; margin: 0 auto 60px; padding: 0 20px; }
    
    .section-header { 
        display: flex;
        justify-content: space-between; align-items: flex-end; margin-bottom: 25px; 
        border-bottom: 2px solid #f1f5f9; padding-bottom: 15px;
    }
    .section-title { font-size: 1.5rem; font-weight: 700; color: #374151; }
    
    .course-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 30px;
    }

    /* Course Card */
    .course-card {
        background: white;
        border-radius: 16px; overflow: hidden;
        border: 1px solid #e5e7eb; transition: 0.3s ease;
        position: relative; display: flex; flex-direction: column;
    }
    .course-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px -10px rgba(0, 0, 0, 0.1); border-color: #bfdbfe; }

    .card-thumb-link { display: block; overflow: hidden; aspect-ratio: 16/9; position: relative; }
    .card-thumb { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
    .course-card:hover .card-thumb { transform: scale(1.05); }

    .card-body { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
    
    .card-meta { display: flex; justify-content: space-between; font-size: 0.8rem; color: #9ca3af; margin-bottom: 10px; }
    .card-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 10px; line-height: 1.4; color: #1f2937; }
    .card-title a { text-decoration: none; color: inherit; transition: 0.2s; }
    .card-title a:hover { color: var(--primary); }
    
    /* FIX: Author Info Styling */
    .author-info { 
        display: flex;
        align-items: center; 
        gap: 12px; 
        margin-top: auto; /* Đẩy xuống đáy card-body */
        padding-top: 15px; 
        border-top: 1px solid #f3f4f6; 
    }
    .author-avatar { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; border: 1px solid #e5e7eb; }
    .author-name { font-size: 0.9rem; font-weight: 600; color: #4b5563; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

    /* Footer Stats in Card */
    .card-footer { 
        background: #f9fafb;
        padding: 12px 20px; border-top: 1px solid #e5e7eb;
        display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; color: #6b7280;
    }

    /* Empty State */
    .empty-state { text-align: center; padding: 60px; background: white; border-radius: 12px; border: 2px dashed #e5e7eb; }
    
    @media (max-width: 768px) {
        .hero-container { flex-direction: column; text-align: center; }
        .stats-row { justify-content: center; }
    }
</style>

<div class="subject-hero">
    <div class="hero-container">
        <img src="<%= subject.image || '/img/default-subject.png' %>" class="subject-thumb-lg" alt="<%= subject.name %>">
        <div class="subject-info">
            <h1><%= subject.name %></h1>
            <p class="subject-desc"><%= subject.description || 'Khám phá các khóa học chất lượng cao thuộc bộ môn này.' %></p>
            
            <div class="stats-row">
                <div class="stat-badge"><i class="fas fa-layer-group"></i> <%= courses.length %> Khóa học</div>
                <% if(typeof totalLessons !== 'undefined') { %>
                    <div class="stat-badge"><i class="fas fa-video"></i> <%= totalLessons %> Bài học</div>
                <% } %>
                <div class="stat-badge"><i class="fas fa-users"></i> Đang cập nhật học viên</div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <%- include('partials/breadcrumb') %>
    <div class="section-header">
        <div class="section-title">Các khóa học nổi bật</div>
    </div>

    <% if(courses && courses.length > 0) { %>
        <div class="course-grid">
            <% courses.forEach(course => { %>
                <div class="course-card">
                    <a href="/course/<%= course._id %>" class="card-thumb-link">
                        <img src="<%= course.thumbnail || 'https://i.ibb.co/BVnNtLhp/default-course.png' %>" class="card-thumb" alt="<%= course.title %>">
                        <% if(course.isPublished) { %>
                            <span style="position:absolute; top:10px; right:10px; background:rgba(0,0,0,0.6); color:white; padding:4px 8px; border-radius:4px; font-size:0.75rem; font-weight:600;">
                                <i class="fas fa-globe"></i> Public
                            </span>
                        <% } else { %>
                            <span style="position:absolute; top:10px; right:10px; background:#f59e0b; color:white; padding:4px 8px; border-radius:4px; font-size:0.75rem; font-weight:600;">
                                <i class="fas fa-lock"></i> Sắp ra mắt
                            </span>
                        <% } %>
                    </a>

                    <div class="card-body">
                        <div class="card-meta">
                            <span><i class="far fa-calendar-alt"></i> <%= new Date(course.createdAt).toLocaleDateString('vi-VN') %></span>
                            <span>Cơ bản</span> 
                        </div>

                        <h3 class="card-title">
                            <a href="/course/<%= course._id %>"><%= course.title %></a>
                        </h3>
                        
                        <p style="font-size:0.9rem; color:#6b7280; line-height:1.5; margin-bottom:15px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                            <%= course.description || 'Chưa có mô tả ngắn.' %>
                        </p>

                        <div class="author-info">
                            <% 
                                const author = course.createdBy || course.author || {}; 
                                const avatar = author.avatar || 'https://cdn.glitch.global/b34fd7c6-dd60-4242-a917-992503c79a1f/7915522.png?v=1745082805191';
                                const name = author.username || 'Ban biên tập';
                            %>
                            <img src="<%= avatar %>" class="author-avatar" alt="Author">
                            <span class="author-name"><%= name %></span>
                        </div>
                    </div>

                    <div class="card-footer">
                        <span><i class="fas fa-book-open"></i> Xem chi tiết</span>
                        <a href="/course/<%= course._id %>" style="color:var(--primary); font-weight:600; text-decoration:none;">
                            Vào học <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
            <% }) %>
        </div>
    <% } else { %>
        <div class="empty-state">
            <i class="fas fa-box-open" style="font-size:3rem; color:#e5e7eb; margin-bottom:15px;"></i>
            <h3>Chưa có khóa học nào</h3>
            <p style="color:#9ca3af;">Nội dung cho môn học này đang được xây dựng.</p>
        </div>
    <% } %>
</div>

<%- include('partials/footer') %>